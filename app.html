<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Access Onboarding Tracker</title>
    <style>
        :root {
            --bg-color: #f4f6f9;
            --blue-light: #e3f2fd;
            --blue-border: #2196f3;
            --red-light: #ffebee;
            --red-border: #f44336;
            --green-light: #e8f5e9;
            --green-border: #4caf50;
            --gray-locked: #f5f5f5;
            --text-main: #333;
            --text-muted: #666;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            color: var(--text-main);
        }

        header {
            max-width: 1200px;
            margin: 0 auto 20px auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        @media (min-width: 768px) {
            header {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
        }

        h1 {
            margin: 0;
            font-size: 1.5rem;
            color: #1a1a1a;
        }

        .header-meta {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-top: 5px;
        }

        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        button:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .btn-reset { background: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
        .btn-export { background: #333; color: white; }
        .btn-import { background: #fff; border: 1px solid #ddd; color: #333; }

        .progress-container {
            max-width: 1200px;
            margin: 0 auto 20px auto;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .progress-bar-bg {
            height: 12px;
            background: #f0f0f0;
            border-radius: 6px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #81c784);
            width: 0%;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
            padding-bottom: 40px;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 16px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border-left: 6px solid #ccc;
            position: relative;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        /* Ecosystem Styling */
        .card.blue { border-left-color: var(--blue-border); background-color: #ffffff; }
        .card.red { border-left-color: var(--red-border); background-color: #ffffff; }
        .card.green { border-left-color: var(--green-border); background-color: #ffffff; }

        .card.locked {
            opacity: 0.5;
            background-color: var(--gray-locked);
            border-left-color: #bbb;
            pointer-events: none;
            filter: grayscale(0.8);
        }

        /* Lock Overlay */
        .lock-overlay {
            display: none;
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255,255,255,0.5);
            z-index: 10;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
        }

        .card.locked .lock-overlay {
            display: flex;
        }

        .lock-message {
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            text-align: center;
            max-width: 80%;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .card-title {
            font-weight: 700;
            font-size: 1.05rem;
            color: #2c3e50;
            margin-bottom: 4px;
        }

        .card-id {
            font-size: 0.7rem;
            color: #999;
            font-family: monospace;
            background: #f5f5f5;
            padding: 2px 5px;
            border-radius: 4px;
            display: inline-block;
        }

        .status-select {
            padding: 8px;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
            font-weight: 600;
            width: 100%;
            cursor: pointer;
            font-size: 0.9rem;
            outline: none;
            transition: background 0.2s;
        }

        .status-select.not-started { background-color: #f8f9fa; color: #5f6368; }
        .status-select.inprogress { background-color: #fff8e1; color: #f57f17; border-color: #ffe082; }
        .status-select.blocked { background-color: #ffebee; color: #c62828; border-color: #ffcdd2; }
        .status-select.done { background-color: #e8f5e9; color: #2e7d32; border-color: #c8e6c9; }

        .fields-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .field-group label {
            display: block;
            font-size: 0.75rem;
            color: #666;
            margin-bottom: 4px;
            font-weight: 500;
        }

        .field-group input {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.85rem;
            box-sizing: border-box;
        }

        .field-group input:focus, .field-group textarea:focus {
            border-color: #2196f3;
            outline: none;
        }

        textarea {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.85rem;
            resize: vertical;
            min-height: 45px;
            box-sizing: border-box;
            font-family: inherit;
        }

        /* Filter Tabs */
        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            padding: 0 20px;
            overflow-x: auto;
        }
        
        .filter-btn {
            background: transparent;
            border: 1px solid #ddd;
            color: #666;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            white-space: nowrap;
        }

        .filter-btn.active {
            background: #333;
            color: white;
            border-color: #333;
        }

    </style>
</head>
<body>

<header>
    <div>
        <h1>Onboarding Access Tracker</h1>
        <div class="header-meta">Auto-saves to browser storage â€¢ Enforces dependencies</div>
    </div>
    <div class="controls">
        <input type="file" id="importFile" style="display:none" onchange="handleImport(this)">
        <button class="btn-import" onclick="document.getElementById('importFile').click()">Import JSON</button>
        <button class="btn-export" onclick="exportData()">Export JSON</button>
        <button class="btn-reset" onclick="resetData()">Reset All</button>
    </div>
</header>

<div class="progress-container">
    <div style="display:flex; justify-content:space-between; align-items:flex-end;">
        <div>
            <strong style="font-size: 1.1rem; color: #2c3e50;">Overall Progress</strong>
            <div style="font-size: 0.85rem; color: #666; margin-top: 4px;">Completed: <span id="count-text">0/0</span></div>
        </div>
        <span id="progress-text" style="font-size: 1.5rem; font-weight: 700; color: #4caf50;">0%</span>
    </div>
    <div class="progress-bar-bg">
        <div class="progress-fill" id="progress-fill"></div>
    </div>
</div>

<div class="filters">
    <button class="filter-btn active" onclick="setFilter('all')">All Access</button>
    <button class="filter-btn" onclick="setFilter('available')">Available to Request</button>
    <button class="filter-btn" onclick="setFilter('blue')">VWGoA (Blue)</button>
    <button class="filter-btn" onclick="setFilter('red')">MSI (Red)</button>
    <button class="filter-btn" onclick="setFilter('green')">CI&T (Green)</button>
    <button class="filter-btn" onclick="setFilter('incomplete')">Pending Only</button>
</div>

<div class="grid" id="app">
    <!-- Cards generated by JS -->
</div>

<script>
    // --- Data Definition ---
    const definitions = [
        // --- CI&T Ecosystem (Green) ---
        { id: "CITEmail", name: "CI&T Email", color: "green", parent: null },
        { id: "CIT_VPN", name: "CI&T VPN", color: "green", parent: "CITEmail" },
        { id: "OneAudiGH", name: "oneAudi GitHub", color: "green", parent: "CITEmail" },
        { id: "NAR_DPS", name: "NAR Digital Prod Support", color: "green", parent: "OneAudiGH" },

        // --- VWGoA Ecosystem (Blue) ---
        { id: "VendorID", name: "Vendor ID (VWGoA LDAP)", color: "blue", parent: null },
        { id: "ExternEmail", name: "Extern Email", color: "blue", parent: "VendorID" },
        
        // Children of Extern Email
        { id: "VWGoAVPN", name: "VWGoA VPN", color: "blue", parent: "ExternEmail" },
        { id: "VWGoAJira", name: "VWGoA Jira", color: "blue", parent: "ExternEmail" },
        { id: "VWGoAConfluence", name: "VWGoA Confluence", color: "blue", parent: "ExternEmail" },
        { id: "LaunchDarkly", name: "Launch Darkly", color: "blue", parent: "ExternEmail" },
        { id: "DevStackAccount", name: "DevStack Account", color: "blue", parent: "ExternEmail" },
        { id: "GitHubEMU", name: "GitHub EMU", color: "blue", parent: "ExternEmail" },
        { id: "GCP", name: "GCP", color: "blue", parent: "ExternEmail" },
        { id: "EA_Jira", name: "EA Jira Project", color: "blue", parent: "ExternEmail" },
        { id: "AEM", name: "AEM Headless (Falcon)", color: "blue", parent: "ExternEmail" },
        { id: "Figma", name: "Figma", color: "blue", parent: "ExternEmail" },
        { id: "SC3", name: "SC3", color: "blue", parent: "ExternEmail" },
        
        // Slacks
        { id: "AudiSFSlack", name: "Audi SF Slack", color: "blue", parent: "ExternEmail" },
        { id: "SlackChannels1", name: "Audi SF Channels", color: "blue", parent: "AudiSFSlack" },
        { id: "CariadSlack", name: "Cariad Slack", color: "blue", parent: "ExternEmail" },
        { id: "SlackChannels2", name: "Cariad Channels", color: "blue", parent: "CariadSlack" },
        { id: "ApolloStudio", name: "Apollo Studio", color: "blue", parent: "ExternEmail" },
        { id: "Flow", name: "/Flow", color: "blue", parent: "ExternEmail" },

        // VWGoA Sub-structures
        { id: "JiraSpaces", name: "Jira Spaces (Gen)", color: "blue", parent: "VWGoAJira" },
        { id: "APPS", name: "Audi Digital Prod Support", color: "blue", parent: "JiraSpaces" },

        { id: "ConfSpaces", name: "Confluence Spaces", color: "blue", parent: "VWGoAConfluence" },
        { id: "ADPS", name: "Audi Digital Prod Support", color: "blue", parent: "ConfSpaces" },
        { id: "AudiIdentity", name: "Audi Identity", color: "blue", parent: "ConfSpaces" },
        { id: "AudiProgMgmt", name: "Audi Program Mgmt", color: "blue", parent: "ConfSpaces" },
        { id: "NARPortfolio", name: "NAR Portfolio", color: "blue", parent: "ConfSpaces" },
        { id: "DealerSupport", name: "One Audi Dealer Support", color: "blue", parent: "ConfSpaces" },
        { id: "EntArch", name: "VWGoA Ent Architecture", color: "blue", parent: "ConfSpaces" },

        { id: "GroupAccessLD", name: "LD Group Access", color: "blue", parent: "LaunchDarkly" },
        { id: "CustRegDev", name: "CustReg Developer", color: "blue", parent: "GroupAccessLD" },
        { id: "PCE_Dev", name: "PCE Developer", color: "blue", parent: "GroupAccessLD" },
        { id: "OSS_Dev", name: "OSS Developer", color: "blue", parent: "GroupAccessLD" },

        { id: "GroupAccessGH", name: "GH Group Access", color: "blue", parent: "GitHubEMU" },
        { id: "AME_Devs", name: "Audi Marketing Ent Devs", color: "blue", parent: "GroupAccessGH" },
        { id: "AME_RelMgrs", name: "Audi Marketing Ent RelMgrs", color: "blue", parent: "GroupAccessGH" },

        { id: "DevStackJira", name: "DevStack Jira", color: "blue", parent: "DevStackAccount" },
        { id: "DevStackConf", name: "DevStack Confluence", color: "blue", parent: "DevStackAccount" },
        { id: "CustRegRel", name: "CustReg RelManager", color: "blue", parent: "DevStackJira" },
        { id: "PCE_Rel", name: "PCE RelManager", color: "blue", parent: "DevStackJira" },
        { id: "OSS_Rel", name: "OSS RelManager", color: "blue", parent: "DevStackJira" },

        // --- MSI Ecosystem (Red) ---
        // Note: MSIAccount depends on ExternEmail (Cross-ecosystem dependency)
        { id: "MSIAccount", name: "MSI Account", color: "red", parent: "ExternEmail" },
        { id: "MSIJira", name: "MSI Jira", color: "red", parent: "MSIAccount" },
        { id: "MSIConfluence", name: "MSI Confluence", color: "red", parent: "MSIAccount" },
        { id: "AWS", name: "AWS", color: "red", parent: "MSIAccount" },
        { id: "RocketChat", name: "RocketChat", color: "red", parent: "MSIAccount" },
        { id: "AppStore", name: "App Store", color: "red", parent: "MSIAccount" },
        
        { id: "MyAudiApp", name: "myAudi app R/P", color: "red", parent: "MSIJira" },
        { id: "WebSupport", name: "WEBSUPPORT", color: "red", parent: "MSIJira" },
        { id: "NAROWN", name: "NAROWN", color: "red", parent: "MSIJira" },
        { id: "CSS1", name: "Car Search Support", color: "red", parent: "MSIJira" },
        { id: "OneAudiNAR", name: "OneAudi NAR", color: "red", parent: "MSIJira" },
        { id: "AudiNAR", name: "AudiNAR (Confluence)", color: "red", parent: "MSIConfluence" }
    ];

    // --- State Management ---
    let accessState = {};
    let currentFilter = 'all';

    function init() {
        const saved = localStorage.getItem('onboarding_state');
        if (saved) {
            try {
                accessState = JSON.parse(saved);
            } catch(e) {
                console.error("Error parsing saved state", e);
                resetStateObject();
            }
        } else {
            resetStateObject();
        }
        render();
    }

    function resetStateObject() {
        accessState = {};
        definitions.forEach(def => {
            accessState[def.id] = {
                status: 'not-started',
                ticket: '',
                date: '',
                notes: ''
            };
        });
    }

    function save() {
        localStorage.setItem('onboarding_state', JSON.stringify(accessState));
        render(); // Re-render to update locks and progress
    }

    function resetData() {
        if(confirm("Are you sure you want to wipe all data and start over?")) {
            localStorage.removeItem('onboarding_state');
            resetStateObject();
            save();
        }
    }

    function updateField(id, field, value) {
        if (!accessState[id]) accessState[id] = {};
        accessState[id][field] = value;
        save();
    }

    function setFilter(filter) {
        currentFilter = filter;
        // Update button styles
        document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        render();
    }

    // --- Import/Export ---
    function exportData() {
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(accessState, null, 2));
        const downloadAnchorNode = document.createElement('a');
        downloadAnchorNode.setAttribute("href", dataStr);
        downloadAnchorNode.setAttribute("download", `onboarding_status_${new Date().toISOString().slice(0,10)}.json`);
        document.body.appendChild(downloadAnchorNode);
        downloadAnchorNode.click();
        downloadAnchorNode.remove();
    }

    function handleImport(inputElement) {
        const file = inputElement.files[0];
        if(!file) return;

        const reader = new FileReader();
        reader.readAsText(file,'UTF-8');
        reader.onload = readerEvent => {
            const content = readerEvent.target.result;
            try {
                const parsed = JSON.parse(content);
                // Basic validation
                if(typeof parsed === 'object') {
                    accessState = parsed;
                    save();
                    alert("Import successful!");
                }
            } catch (err) {
                alert("Invalid JSON file. Please upload a file generated by this tool.");
            }
        }
        // Reset input
        inputElement.value = '';
    }

    // --- Rendering ---
    function render() {
        const container = document.getElementById('app');
        container.innerHTML = '';

        let totalTasks = definitions.length;
        let completedTasks = 0;

        definitions.forEach(def => {
            // Ensure state object exists
            if(!accessState[def.id]) {
                accessState[def.id] = { status: 'not-started', ticket: '', date: '', notes: '' };
            }
            const data = accessState[def.id];
            
            // Check Dependency Locking
            let isLocked = false;
            let parentName = '';
            
            if (def.parent) {
                const parentDef = definitions.find(d => d.id === def.parent);
                if (parentDef) {
                    parentName = parentDef.name;
                    const parentData = accessState[def.parent];
                    if (!parentData || parentData.status !== 'done') {
                        isLocked = true;
                    }
                }
            }

            // Stats
            if (data.status === 'done') completedTasks++;

            // Filtering
            if (currentFilter !== 'all') {
                if (currentFilter === 'incomplete') {
                    if (data.status === 'done') return;
                } else if (currentFilter === 'available') {
                    if (isLocked || data.status === 'done') return;
                } else if (['blue', 'red', 'green'].includes(currentFilter)) {
                    if (def.color !== currentFilter) return;
                }
            }

            // HTML Construction
            const card = document.createElement('div');
            card.className = `card ${def.color} ${isLocked ? 'locked' : ''}`;
            
            card.innerHTML = `
                <div class="lock-overlay">
                    <div class="lock-message">ðŸ”’<br>Complete ${parentName}<br>First</div>
                </div>

                <div class="card-header">
                    <div style="flex-grow:1">
                        <div class="card-title">${def.name}</div>
                        <div class="card-id">${def.id}</div>
                    </div>
                </div>

                <select class="status-select ${data.status}" onchange="updateField('${def.id}', 'status', this.value)" ${isLocked ? 'disabled' : ''}>
                    <option value="not-started" ${data.status === 'not-started' ? 'selected' : ''}>âšª Not Started</option>
                    <option value="inprogress" ${data.status === 'inprogress' ? 'selected' : ''}>ðŸŸ¡ In Progress</option>
                    <option value="blocked" ${data.status === 'blocked' ? 'selected' : ''}>ðŸ”´ Blocked</option>
                    <option value="done" ${data.status === 'done' ? 'selected' : ''}>ðŸŸ¢ Done / Granted</option>
                </select>

                <div class="fields-row">
                    <div class="field-group">
                        <label>Ticket #</label>
                        <input type="text" value="${data.ticket}" placeholder="JIRA-..." 
                               oninput="updateField('${def.id}', 'ticket', this.value)" ${isLocked ? 'disabled' : ''}>
                    </div>
                    <div class="field-group">
                        <label>Date Req.</label>
                        <input type="date" value="${data.date}" 
                               onchange="updateField('${def.id}', 'date', this.value)" ${isLocked ? 'disabled' : ''}>
                    </div>
                </div>

                <div class="field-group">
                    <label>Notes</label>
                    <textarea placeholder="Notes..." 
                              oninput="updateField('${def.id}', 'notes', this.value)" ${isLocked ? 'disabled' : ''}>${data.notes}</textarea>
                </div>
            `;
            container.appendChild(card);
        });

        // Update Progress Bar
        const percentage = Math.round((completedTasks / totalTasks) * 100);
        document.getElementById('progress-text').innerText = `${percentage}%`;
        document.getElementById('count-text').innerText = `${completedTasks} / ${totalTasks}`;
        document.getElementById('progress-fill').style.width = `${percentage}%`;
    }

    // Start
    init();

</script>

</body>
</html>
